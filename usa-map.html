<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title></title>

<!-- D3 + topojson from CDN -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/topojson-client@3"></script>

<style>
  :root{
    --bg: #f6f9fc;
    --card: #ffffff;
    --accent: #B31942;
    --muted: #B31942;
    --selected: #B31942;
  }
  html,body { height:100%; margin:0; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:#0b1220; }
  .wrap {
    max-width: 1100px;
    margin: 28px auto;
    padding: 18px;
  }
  .card {
    background: var(--card);
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(10,49,97,0.08);
    padding: 18px;
  }

  header {
    display:flex;
    gap:12px;
    align-items: center;
    margin-bottom: 12px;
  }
  h1 { font-size: 1.05rem; margin:0; letter-spacing: -0.2px; }
  .subtitle { color:var(--muted); font-size:0.9rem; }

  /* Map container */
  .map-wrap {
    width: 100%;
    min-height: 560px;
    position: relative;
    overflow: hidden;
    border-radius: 10px;
  }

  svg { width:100%; height:100%; display:block; }

  .state {
    fill: #e8eef6;
    stroke: #fff;
    stroke-width: 0.8;
    cursor: pointer;
    transition: fill 160ms ease, transform 120ms ease;
  }
  .state:hover, .state:focus {
    fill: #cfe0f6;
    outline: none;
    transform: translateY(-1px);
  }
  .state.selected {
    fill: var(--selected);
    color: white;
    filter: drop-shadow(0 6px 14px rgba(179,25,66,0.12));
  }

  /* tooltip */
  .tooltip {
    position: absolute;
    pointer-events: none;
    background: rgba(10,49,97,0.98);
    color: #fff;
    padding: 8px 10px;
    border-radius: 8px;
    font-size: 13px;
    box-shadow: 0 8px 30px rgba(10,49,97,0.15);
    transform: translate(-50%, -120%);
    white-space: nowrap;
    display: none;
    z-index: 10;
  }



  /* small help text */
  .help { margin-left:auto; font-size: 13px; color:var(--muted); }
</style>
</head>
<body>

<div class="wrap">
  <div class="card">
    <header>
      <div>
        <h1></h1>
        <div class="subtitle"></div>
      </div>
      <div class="help">.</div>
    </header>

    <div class="map-wrap" id="map-wrap">
      <div id="tooltip" class="tooltip" role="status" aria-live="polite"></div>
      <svg id="svg-map" viewBox="0 0 975 610" preserveAspectRatio="xMidYMid meet" aria-label=""></svg>
    </div>

 
  </div>
</div>

<script>
(async function() {
  const svg = d3.select("#svg-map");
  const tooltip = d3.select("#tooltip");
  const width = 975, height = 610; // base viewBox
  const mapWrap = document.getElementById("map-wrap");

  // Projection & path
  const projection = d3.geoAlbersUsa().translate([width/2, height/2]).scale(1280);
  const path = d3.geoPath(projection);

  // Create a container group for zooming/panning
  const g = svg.append("g").attr("class", "map-g");

  // Load TopoJSON (us-atlas)
  // Using CDN-hosted us-atlas; no CORS issues in modern browsers.
  const topoUrl = "https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json";
  const topo = await fetch(topoUrl).then(r => r.json());

  // Convert topojson to geojson features for states
  const states = topojson.feature(topo, topo.objects.states).features;
  // There's also 'us' topology if you want counties, etc.

  // OPTIONAL: Example data mapping --- map state id (fips) to a sample numeric value.
  // Replace with your real data keyed by state's ISO or FIPS as needed.
  const sampleValues = {};
  // assign random-ish values for demo coloring
  states.forEach(s => {
    sampleValues[s.id] = Math.round(Math.random() * 100); // 0..100
  });

  // Color scale for values
  const color = d3.scaleQuantize().domain([0,100])
    .range(["#e8eef6","#8fb6ea","#3a75c4"]);

  // Draw states
  g.selectAll("path.state")
    .data(states)
    .enter()
    .append("path")
      .attr("class", "state")
      .attr("d", path)
      .attr("tabindex", 0)
      .attr("aria-label", d => d.properties && d.properties.name ? d.properties.name : "State")
      .style("fill", d => color(sampleValues[d.id])) // fill with data-driven color
      .on("mousemove", (event, d) => {
        const [mx,my] = d3.pointer(event, mapWrap);
        tooltip
          .style("left", mx + "px")
          .style("top", my + "px")
          .style("display", "block")
          .html(`<strong>${d.properties.name}</strong><div style="font-size:12px;color:#cbd7ec">value: ${sampleValues[d.id]}</div>`);
      })
      .on("mouseleave", () => tooltip.style("display","none"))
      .on("click", function(event, d) {
        const el = d3.select(this);
        const selected = el.classed("selected");
        el.classed("selected", !selected);
        // You could store selected states in a Set and do more with them.
      })
      .on("keydown", (event, d) => {
        if(event.key === "Enter" || event.key === " ") {
          // toggle selection via keyboard
          const el = d3.select(event.currentTarget);
          el.classed("selected", !el.classed("selected"));
        }
      });

  // Add state borders (optional for crispness) using mesh
  g.append("path")
    .datum(topojson.mesh(topo, topo.objects.states, (a,b) => a !== b))
    .attr("class","state-borders")
    .attr("d", path)
    .attr("fill","none")
    .attr("stroke","#fff")
    .attr("stroke-width",2)
    .attr("pointer-events","none");

  // Add simple labels for larger states (optional)
  // We filter to labels where centroids exist inside the path bounding box.
  const labels = g.selectAll("text.label")
    .data(states.filter(d => {
      // crude area filter to avoid tiny states; adjust threshold as needed
      return d3.geoArea(d) > 0.0006;
    }))
    .enter()
    .append("text")
      .attr("class","label")
      .attr("transform", d => {
        const c = path.centroid(d);
        return `translate(${c[0]},${c[1]})`;
      })
      .attr("text-anchor","middle")
      .attr("dy","0.35em")
      .style("font-size","9px")
      .style("pointer-events","none")
      .style("fill","#0A3161")
      .text(d => d.properties && d.properties.name ? d.properties.name.split(' ')[0] : '');

  // Zoom & pan
  const zoom = d3.zoom()
    .scaleExtent([1, 8])
    .on("zoom", (event) => {
      g.attr("transform", event.transform);
    });

  svg.call(zoom);

  // Make SVG responsive: preserve viewBox but let CSS size it
  svg.attr("viewBox", `0 0 ${width} ${height}`);

  // OPTIONAL: public helper to update colors based on new data
  // usage: updateData({ '01': 45, '02': 12, ... })
  window.updateMapData = function(newData) {
    // newData keyed by state FIPS (same as topo features' d.id)
    g.selectAll("path.state")
      .transition().duration(350)
      .style("fill", d => {
        const v = newData[d.id];
        return v == null ? "#e8eef6" : color(v);
      });
  };

  // Accessibility: Hide tooltip when focus leaves map
  svg.on("focusout", () => tooltip.style("display","none"));

  // Fit to container on resize: optional simple handler to keep the SVG looking good
  function fitToContainer() {
    // no action needed because viewBox + css handle it; keep hook for future tweaks
  }
  window.addEventListener("resize", fitToContainer);
})();
</script>
</body>
</html>
